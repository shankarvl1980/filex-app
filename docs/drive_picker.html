<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Drive Folder Picker</title>
  <script src="https://apis.google.com/js/api.js?onload=onApiLoad" async defer></script>
</head>
<body>
<script>
  const DEVELOPER_KEY = "AIzaSyDAazPfoPYllwo8hsNWIDMB1ASGiL5X_gk";
    const APP_ID = "603518003549"; // numericlÌ¥
  const SCOPE = ["https://www.googleapis.com/auth/drive.file"];

  function getToken() {
    const u = new URL(window.location.href);
    return u.searchParams.get("token");
  }

  function onApiLoad() {
    gapi.load("picker", { callback: createPicker });
  }

  function createPicker() {
    const token = getToken();
    if (!token) {
      if (window.AndroidBridge) AndroidBridge.onCancel("Missing token");
      return;
    }

    // âœ… Folders view that actually allows selecting folders
    const foldersView = new google.picker.DocsView()
      .setIncludeFolders(true)
      .setSelectFolderEnabled(true)
      .setMimeTypes("application/vnd.google-apps.folder"); // force folders only

    const picker = new google.picker.PickerBuilder()
      .setAppId(APP_ID)
      .setDeveloperKey(DEVELOPER_KEY)
      .setOAuthToken(token)
      .setOrigin(window.location.origin)
      .addView(foldersView)
      .setCallback(pickerCallback)
      .build();

    picker.setVisible(true);
  }

  function pickerCallback(data) {
  try {
    // ðŸ”Ž FULL payload from Google Picker
    console.log("PICKER CALLBACK RAW =", JSON.stringify(data));

    const Action = google.picker.Action;

    if (data.action === Action.PICKED) {
      console.log("PICKED docs =", JSON.stringify(data.docs));

      const doc = data.docs && data.docs[0];
      if (doc) {
        console.log("DOC ID =", doc.id);
        console.log("DOC NAME =", doc.name || doc.title);

        if (window.AndroidBridge && AndroidBridge.onPickedFolder) {
          AndroidBridge.onPickedFolder(
            String(doc.id),
            String(doc.name || doc.title || "Drive Folder")
          );
          return;
        }
      }

      console.log("PICKED but doc missing or bridge missing");
      if (window.AndroidBridge) AndroidBridge.onCancel("Picked but doc missing");
    }
    else if (data.action === Action.CANCEL) {
      console.log("PICKER CANCELLED");
      if (window.AndroidBridge) AndroidBridge.onCancel("User cancelled");
    }
    else {
      console.log("OTHER ACTION =", data.action);
    }

  } catch (e) {
    console.error("PICKER CALLBACK ERROR", e);
    if (window.AndroidBridge) AndroidBridge.onCancel("JS error: " + e);
  }
}

</script>
</body>
</html>
