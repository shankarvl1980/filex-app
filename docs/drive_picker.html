<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Drive Folder Picker</title>
  <script src="https://apis.google.com/js/api.js?onload=onApiLoad" async defer></script>
</head>
<body>
<script>
  const DEVELOPER_KEY = "AIzaSyDAazPfoPYllwo8hsNWIDMB1ASGiL5X_gk";
    const APP_ID = "603518003549"; // numericl̥
  const SCOPE = ["https://www.googleapis.com/auth/drive.file"];

  function getToken() {
    const u = new URL(window.location.href);
    return u.searchParams.get("token");
  }

  function onApiLoad() {
    gapi.load("picker", { callback: createPicker });
  }

  function createPicker() {
    const token = getToken();
    if (!token) {
      if (window.AndroidBridge) AndroidBridge.onCancel("Missing token");
      return;
    }

    // ✅ Folders view that actually allows selecting folders
    const foldersView = new google.picker.DocsView()
      .setIncludeFolders(true)
      .setSelectFolderEnabled(true)
      .setMimeTypes("application/vnd.google-apps.folder"); // force folders only

    const picker = new google.picker.PickerBuilder()
      .setAppId(APP_ID)
      .setDeveloperKey(DEVELOPER_KEY)
      .setOAuthToken(token)
      .setOrigin(window.location.origin)
      .addView(foldersView)
      .setCallback(pickerCallback)
      .build();

    picker.setVisible(true);
  }

  function pickerCallback(data) {
    try {
      const Action = google.picker.Action;

      if (data.action === Action.PICKED) {
        const doc = data.docs && data.docs[0];
        // For folders, id is the folderId
        if (doc && doc.id) {
          const name = doc.name || doc.title || "Drive Folder";
          if (window.AndroidBridge && AndroidBridge.onPickedFolder) {
            AndroidBridge.onPickedFolder(String(doc.id), String(name));
            return;
          }
        }
        if (window.AndroidBridge) AndroidBridge.onCancel("Picked but doc missing");
      } else if (data.action === Action.CANCEL) {
        if (window.AndroidBridge) AndroidBridge.onCancel("User cancelled");
      }
    } catch (e) {
      if (window.AndroidBridge) AndroidBridge.onCancel("JS error: " + e);
    }
  }
</script>
</body>
</html>
